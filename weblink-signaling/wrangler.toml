name = "weblink-signaling"
main = "cloudflare/worker.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# Worker account settings — set CF_ACCOUNT_ID in GitHub Actions secrets / local env
account_id = "${CF_ACCOUNT_ID}"

[vars]
# Default: allow all origins. Override per-environment below.
ALLOWED_ORIGINS = "*"

# ── Durable Objects ───────────────────────────────────────────────────────────
[[durable_objects.bindings]]
name = "SIGNALING_ROOM"
class_name = "SignalingRoom"

[[migrations]]
tag = "v1"
new_classes = ["SignalingRoom"]

# ── Routes ────────────────────────────────────────────────────────────────────
[[routes]]
pattern = "ws.weblink.skworld.io/*"
zone_name = "skworld.io"

# ── Production environment ────────────────────────────────────────────────────
[env.production]
vars = { ALLOWED_ORIGINS = "https://skworld.io,https://skchat.skworld.io,https://weblink.skworld.io" }

# ── Development environment ───────────────────────────────────────────────────
[env.dev]
vars = { ALLOWED_ORIGINS = "*" }

# ── Build ─────────────────────────────────────────────────────────────────────
[build]
# TypeScript is compiled automatically by wrangler
# command = ""

# ── Observability ─────────────────────────────────────────────────────────────
[observability]
enabled = true
